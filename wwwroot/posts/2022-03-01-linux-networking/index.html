<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Linux Networking Reference | Gustavo&#39;s blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Contents TOC {:toc} Introduction I have spent the last 2 years working on Azure products that relied heavily on different networking features of various Linux distributions. I found myself really struggling trying to understand how to connect the &ldquo;what&rdquo; and &ldquo;why&rdquo; book knowledge of compute networking with the &ldquo;how&rdquo; of the Linux networking stack. Initially I just blamed my ignorance of Linux tools, but soon my opinion changed from blame to empathy for me and for all other developers who, like me, have read a book or two but have not spent much time hands-on-keyboard trying to configure a network.">
    <meta name="generator" content="Hugo 0.102.3" />
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="Linux Networking Reference" />
<meta property="og:description" content="Contents TOC {:toc} Introduction I have spent the last 2 years working on Azure products that relied heavily on different networking features of various Linux distributions. I found myself really struggling trying to understand how to connect the &ldquo;what&rdquo; and &ldquo;why&rdquo; book knowledge of compute networking with the &ldquo;how&rdquo; of the Linux networking stack. Initially I just blamed my ignorance of Linux tools, but soon my opinion changed from blame to empathy for me and for all other developers who, like me, have read a book or two but have not spent much time hands-on-keyboard trying to configure a network." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://gustavohidalgo.com/posts/2022-03-01-linux-networking/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-02T12:34:23-04:00" />
<meta property="article:modified_time" content="2022-03-02T12:34:23-04:00" />

<meta itemprop="name" content="Linux Networking Reference">
<meta itemprop="description" content="Contents TOC {:toc} Introduction I have spent the last 2 years working on Azure products that relied heavily on different networking features of various Linux distributions. I found myself really struggling trying to understand how to connect the &ldquo;what&rdquo; and &ldquo;why&rdquo; book knowledge of compute networking with the &ldquo;how&rdquo; of the Linux networking stack. Initially I just blamed my ignorance of Linux tools, but soon my opinion changed from blame to empathy for me and for all other developers who, like me, have read a book or two but have not spent much time hands-on-keyboard trying to configure a network."><meta itemprop="datePublished" content="2022-03-02T12:34:23-04:00" />
<meta itemprop="dateModified" content="2022-03-02T12:34:23-04:00" />
<meta itemprop="wordCount" content="1059">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux Networking Reference"/>
<meta name="twitter:description" content="Contents TOC {:toc} Introduction I have spent the last 2 years working on Azure products that relied heavily on different networking features of various Linux distributions. I found myself really struggling trying to understand how to connect the &ldquo;what&rdquo; and &ldquo;why&rdquo; book knowledge of compute networking with the &ldquo;how&rdquo; of the Linux networking stack. Initially I just blamed my ignorance of Linux tools, but soon my opinion changed from blame to empathy for me and for all other developers who, like me, have read a book or two but have not spent much time hands-on-keyboard trying to configure a network."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Gustavo&#39;s blog
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Linux Networking Reference</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-03-02T12:34:23-04:00">March 2, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="contents">Contents</h1>
<ul>
<li>TOC
{:toc}</li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>I have spent the last 2 years working on Azure products that relied heavily on different networking features of various Linux distributions.
I found myself really struggling trying to understand how to connect the &ldquo;what&rdquo; and &ldquo;why&rdquo; book knowledge of compute networking with the &ldquo;how&rdquo; of the Linux networking stack.
Initially I just blamed my ignorance of Linux tools, but soon my opinion changed from blame to empathy for me and for all other developers who, like me, have read a book or two but have not spent much time hands-on-keyboard trying to configure a network.
If you&rsquo;re reading this, I assume that you know <em>something</em> about computer networking but not enough to call yourself a network engineer.
I&rsquo;m not going to explain what Ethernet is, what IP is, TCP/UDP, HTTP, routing protocols, etc&hellip;
I am going to write about the <em>tools</em> available to manipulate the networking system of Linux so that you can reference <em>how</em> to do something.
Along the way, I try to explain the history and trajectory of the network system to motivate why things are the way they are.</p>
<h1 id="glossary-of-linux-networking-tools-concepts-words-you-should-recognize">Glossary of linux networking tools, concepts, words you should recognize</h1>
<ol>
<li><code>iproute2</code> : A collection of userspace utilities for interacting with the kernel networking system.</li>
<li><code>ip(8)</code> : One of the the tools included in the <code>iproute2</code> collection. Knowing <code>ip(8)</code> will allow you do to like 80% of everything you will ever want to do with kernel networking.</li>
<li><code>tcpdump(1)</code> : A command-line packet capture tool.</li>
<li><code>libpcap</code> : The library that <code>tcpdump</code> and Wireshark depend on.</li>
<li><code>netlink</code> : The communication protocol between userspace and the kernel for networking configuration. Prior to netlink, <code>ioctl(2)</code> was often used to communicate with the kernel, and I guess creating many dedicated system calls for the networking subsystem was undesirable.</li>
<li><code>iptables</code>: One of the kernel IP filtering and processing modules. <code>iptables</code> was superceded by <code>nftables</code>, if someone is telling to you to use <code>iptables</code> kindly tell them to go read about <code>nftables</code> and then use <code>nftables</code>.</li>
<li><code>NAPI</code> : &ldquo;New API&rdquo; a kernel networking enhancement that, among other things, reduces kernel interrupt load during periods of high network utilization.</li>
<li><code>netfilter</code> : The FOSS project behind <code>iptables</code> and <code>nftables</code>.</li>
<li><code>nftables</code>: A newer IP filtering and processing module. You can use <code>nftables</code> to do very cool packet rewriting, routing, and forwarding things. <code>nftables</code> CLI tool is <code>nft</code>.</li>
<li><code>DPDK</code> : DataPlane Development Kit. One of several kernel bypass technologies that allow userspace to control a NIC for higher performance. This is outside the scope of this article, but you should know what it means.</li>
</ol>
<h1 id="what-can-you-do-with-ip8">What can you do with <code>ip(8)</code></h1>
<h4 id="address-resolution-protocol-arp">Address Resolution Protocol (ARP)</h4>
<p><a href="https://datatracker.ietf.org/doc/html/rfc826">RFC 826</a></p>
<p>ARP is the protocol used to discover the physical addresses for IP addresses on the local network.
A host builds an ARP table as it learns the physical addresses of other hosts on the network.
You can interpret that to mean that an entry in the ARP table is in the same layer-2 broadcast domain as the host you are on.</p>
<p>You can examine your ARP table like this:</p>
<pre tabindex="0"><code>gustavo@ubuntu:~$ ip neighbor
192.168.1.236 dev ens33 lladdr ac:e2:d3:88:a0:61 STALE
192.168.1.254 dev ens33 lladdr 38:a0:67:5a:f1:22 REACHABLE
</code></pre><h4 id="view-and-modify-your-routing-table">View and modify your routing table</h4>
<p>You can inspect your routing table with <code>ip route</code>:</p>
<pre tabindex="0"><code>gustavo@ubuntu:~$ ip route
default via 192.168.1.254 dev ens33 proto dhcp metric 100 
169.254.0.0/16 dev ens33 scope link metric 1000 
192.168.1.0/24 dev ens33 proto kernel scope link src 192.168.1.192 metric 100
</code></pre><p>You might think the display order is significant, but it&rsquo;s not.
The <em>most specific</em> route is always chosen, most commonly decided by the longest matching prefix of the address being routed to.</p>
<p>If you don&rsquo;t believe it, you can evaluate what route is chosen for a given address using <code>ip route get</code>:</p>
<pre tabindex="0"><code>gustavo@ubuntu:~$ ip route get 8.8.8.8
8.8.8.8 via 172.20.10.1 dev ens33 src 172.20.10.5 uid 1000
</code></pre><p>This means that traffic to <code>8.8.8.8</code> will be forwarded to <code>172.20.10.1</code> using device <code>ens33</code> with source address <code>172.20.10.5</code>.
I&rsquo;m not sure yet why there is a <code>uid</code> associated with this route.</p>
<h4 id="view-and-modify-your-interfaces">View and modify your interfaces</h4>
<p>You can use <code>ip link</code> to view all the interfaces on your system:</p>
<pre tabindex="0"><code>ustavo@ubuntu:~$ ip link
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 00:0c:29:70:61:d6 brd ff:ff:ff:ff:ff:ff
    altname enp2s1
5: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/none
</code></pre><p>Normally you will see at least 2 interfaces: your <code>lo</code> interface for loopback traffic on <code>127.0.0.1</code> (or <code>::1</code> for IPv6!)</p>
<h1 id="what-can-you-do-with-tcpdump">What can you do with <code>tcpdump</code></h1>
<p>There are a few arguments you will always want to pass to tcpdump for a more sane experience:</p>
<ol>
<li><code>sudo</code> : Obviously, you need to be root to capture packets on an interface, lest we tag packets with <code>uid</code>s.</li>
<li><code>-n</code> : This disables reverse DNS lookups which sometimes blocks <code>tcpdump</code>. I don&rsquo;t know why the authors of <code>tcpdump</code> thought it a good idea to enable this by default :(</li>
<li><code>-i</code> : This selects the interface you want to snoop on. If you don&rsquo;t specify this, <code>tcpdump</code> kinda just selects an interface which is usually <em>okay</em> but on systems with multiple interfaces it&rsquo;s definitely not desirable.</li>
<li><code>-v</code> : Does a protocol decode. Not strictly required but I usually add this to avoid having to repro the capture because I didn&rsquo;t see the information I was looking for.</li>
</ol>
<p>For a full explanation of the <code>expression</code> argument, you can run <code>man pcap-filter</code>.</p>
<h2 id="capture">Capture</h2>
<h1 id="what-can-you-do-with-nftables">What can you do with <code>nftables</code></h1>
<h1 id="network-managers">Network managers</h1>
<p>What are these?</p>
<h2 id="special-mention-to-systemd">Special mention to <code>systemd</code></h2>
<h1 id="network-namespaces-docker">Network namespaces (Docker)</h1>
<h1 id="single-root-io-virtualization">Single-root IO Virtualization</h1>
<p>What is this, what does it mean for me?</p>
<h1 id="scenarios">Scenarios</h1>
<h2 id="metering-measurement-and-throttling">Metering (Measurement and Throttling)</h2>
<h2 id="policy-routing">Policy Routing</h2>
<h2 id="firewalling">Firewalling</h2>
<h2 id="nating">NATing</h2>
<h1 id="faq">FAQ</h1>
<h2 id="if-there-is-an-iproute2-was-there-an-iproute-why-the-2">If there is an <code>iproute2</code>, was there an <code>iproute</code>? Why the 2?</h2>
<p>Who knows?</p>
<h2 id="why-are-interfaces-sometimes-named-ethn-and-sometimes-ens33-or-something-like-that">Why are interfaces sometimes named <code>ethN</code> and sometimes <code>ens33</code> or something like that?</h2>
<p>SystemD ? <a href="https://systemd.io/PREDICTABLE_INTERFACE_NAMES/">https://systemd.io/PREDICTABLE_INTERFACE_NAMES/</a></p>
<h2 id="some-ip-address-ranges-keep-being-used-over-and-over-why">Some IP address ranges keep being used over and over, why?</h2>
<p>Refer to <a href="https://www.ietf.org/rfc/rfc3330.txt">https://www.ietf.org/rfc/rfc3330.txt</a> for all the special blocks,   but notably:
<code>169.254.0.0/16</code> : Link-local addresses
<code>10.0.0.0/8</code> : Private address space
<code>172.16.0.0/16</code>  : Private address space
<code>192.168.0.0/16</code> : Private address space
<code>100.64.0.0/10</code> : CGNAT address space, <a href="https://datatracker.ietf.org/doc/html/rfc6598">https://datatracker.ietf.org/doc/html/rfc6598</a></p>
<h1 id="references">References</h1>
<p>iptables <a href="https://linux.die.net/man/8/iptables">https://linux.die.net/man/8/iptables</a>
iproute2 <a href="https://wiki.linuxfoundation.org/networking/iproute2">https://wiki.linuxfoundation.org/networking/iproute2</a>
Arch Wiki <a href="https://wiki.archlinux.org/title/Network_configuration">https://wiki.archlinux.org/title/Network_configuration</a>
tcpdump <a href="https://www.tcpdump.org">https://www.tcpdump.org</a>
numbers next to commands <a href="https://superuser.com/questions/297702/what-do-the-parentheses-and-number-after-a-unix-command-or-c-function-mean">https://superuser.com/questions/297702/what-do-the-parentheses-and-number-after-a-unix-command-or-c-function-mean</a>
NAPI : <a href="https://www.usenix.org/legacy/publications/library/proceedings/als01/full_papers/jamal/jamal.pdf">https://www.usenix.org/legacy/publications/library/proceedings/als01/full_papers/jamal/jamal.pdf</a>
Netfilter <a href="https://www.netfilter.org">https://www.netfilter.org</a>
Policy Routing Book: <a href="http://www.policyrouting.org/PolicyRoutingBook/ONLINE/TOC.html">http://www.policyrouting.org/PolicyRoutingBook/ONLINE/TOC.html</a></p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://gustavohidalgo.com/" >
    &copy;  Gustavo's blog 2022 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
