<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Swagger from C# code | Gustavo&#39;s blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Problem At work we write a lot of ASP.NET REST controllers. Some of the controllers have their API documented in the Azure REST API specs in the form of a Swagger specification, and some are consumed internally by a system that requires us to expose a Swagger specification. This is our problem: say we want to write a controller for Widgets that supports CRUD operations. A developer has to:
Write the C# code.">
    <meta name="generator" content="Hugo 0.102.3" />
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="Swagger from C# code" />
<meta property="og:description" content="Problem At work we write a lot of ASP.NET REST controllers. Some of the controllers have their API documented in the Azure REST API specs in the form of a Swagger specification, and some are consumed internally by a system that requires us to expose a Swagger specification. This is our problem: say we want to write a controller for Widgets that supports CRUD operations. A developer has to:
Write the C# code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://gustavohidalgo.com/posts/2021-07-11-swagger-from-code/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-11T12:34:23-04:00" />
<meta property="article:modified_time" content="2021-07-11T12:34:23-04:00" />

<meta itemprop="name" content="Swagger from C# code">
<meta itemprop="description" content="Problem At work we write a lot of ASP.NET REST controllers. Some of the controllers have their API documented in the Azure REST API specs in the form of a Swagger specification, and some are consumed internally by a system that requires us to expose a Swagger specification. This is our problem: say we want to write a controller for Widgets that supports CRUD operations. A developer has to:
Write the C# code."><meta itemprop="datePublished" content="2021-07-11T12:34:23-04:00" />
<meta itemprop="dateModified" content="2021-07-11T12:34:23-04:00" />
<meta itemprop="wordCount" content="726">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Swagger from C# code"/>
<meta name="twitter:description" content="Problem At work we write a lot of ASP.NET REST controllers. Some of the controllers have their API documented in the Azure REST API specs in the form of a Swagger specification, and some are consumed internally by a system that requires us to expose a Swagger specification. This is our problem: say we want to write a controller for Widgets that supports CRUD operations. A developer has to:
Write the C# code."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Gustavo&#39;s blog
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Swagger from C# code</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-07-11T12:34:23-04:00">July 11, 2021</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="problem">Problem</h1>
<p>At work we write a lot of ASP.NET REST controllers.
Some of the controllers have their API documented in the <a href="https://github.com/Azure/azure-rest-api-specs">Azure REST API</a> specs in the form of a <a href="https://swagger.io/specification/v2/">Swagger</a> specification, and some are consumed internally by a system that requires us to expose a Swagger specification. This is our problem: say we want to write a controller for <code>Widget</code>s that supports CRUD operations. A developer has to:</p>
<ol>
<li>Write the C# code.</li>
<li>Write the Swagger JSON necessary.</li>
<li>Ensure (erm, try really hard) to make sure the swagger and the C# stay consistent with each other.</li>
<li>Ship the Swagger to the clients.</li>
</ol>
<p>There are existing tools like <a href="https://github.com/RicoSuter/NSwag">NSwag</a> and <a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore">Swashbuckle</a> that are almost tailor made for this but they assume you&rsquo;re going to generate perfectly legal OpenAPIv2/3 documents, which I&rsquo;m not because this internal swagger has some&hellip; <em>customizations</em>. We can easily adapt a proper Swagger document into our custom format, ultimately we are trying to generate a swagger document at build time from our source code which we will then transform some more (again, at build time!).</p>
<h1 id="solution">Solution</h1>
<p>Thankfully NSwag has a component that does almost exactly what we need: <a href="https://github.com/RicoSuter/NSwag/wiki/NSwag.MSBuild">NSwag.MSBuild</a>. With this package, we can generate a Swagger document for some or all of the controllers in an assembly, and then we can modify the document to fit our custom Swagger format. Let&rsquo;s see how it works:</p>
<p>First I generate a small project with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>&gt; dotnet new webapi
</span></span></code></pre></div><p>At this time, this template contains one controller with a GET method on <code>/WeatherForecast</code> that returns an object with weather forecast data.</p>
<p>Then I add a dependency on NSwag with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>&gt; dotnet add package NSwag.AspNetCore
</span></span><span style="display:flex;"><span>&gt; dotnet add package NSwag.MSBuild 
</span></span></code></pre></div><p>This is my <code>Startup.cs</code> with the call to <code>AddSwaggerDocument</code>, this is <strong>necessary</strong> for the generator to discover controllers in the assembly:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Startup</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Startup(IConfiguration configuration)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Configuration = configuration;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IConfiguration Configuration { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureServices(IServiceCollection services)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        services.AddControllers();
</span></span><span style="display:flex;"><span>        services.AddSwaggerDocument();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (env.IsDevelopment())
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            app.UseDeveloperExceptionPage();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        app.UseHttpsRedirection();
</span></span><span style="display:flex;"><span>        app.UseRouting();
</span></span><span style="display:flex;"><span>        app.UseAuthorization();
</span></span><span style="display:flex;"><span>        app.UseEndpoints(endpoints =&gt;
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            endpoints.MapControllers();
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And finally I add a target in the project file to call the Swagger generator executable. Note that I am on a Mac so I have to call the generator with the property for .NET 5.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;Target</span> <span style="color:#a6e22e">Name=</span><span style="color:#e6db74">&#34;NSwag&#34;</span> <span style="color:#a6e22e">AfterTargets=</span><span style="color:#e6db74">&#34;Build&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;Exec</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">EnvironmentVariables=</span><span style="color:#e6db74">&#34;ASPNETCORE_ENVIRONMENT=Development&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Command=</span><span style="color:#e6db74">&#34;$(NSwagExe_Net50) aspnetcore2openapi /assembly:$(TargetDir)$(MSBuildProjectName).dll /output:swagger.json&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/Target&gt;</span>
</span></span></code></pre></div><p>Some nice build output:</p>
<pre tabindex="0"><code>Microsoft (R) Build Engine version 16.8.0+126527ff1 for .NET
Copyright (C) Microsoft Corporation. All rights reserved.

  Determining projects to restore...
  All projects are up-to-date for restore.
  swaggergen -&gt; /Users/gustavo/code/swaggergen/bin/Debug/net5.0/swaggergen.dll
  NSwag command line tool for .NET Core Net50, toolchain v13.11.3.0 (NJsonSchema v10.4.4.0 (Newtonsoft.Json v12.0.0.0))
  Visit http://NSwag.org for more information.
  NSwag bin directory: /Users/gustavo/.nuget/packages/nswag.msbuild/13.11.3/tools/Net50
  Code has been successfully written to file.
  
  Duration: 00:00:00.8377024

Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:03.55
</code></pre><p>And finally, a <code>swagger.json</code> file is produced next to our project file.
Let&rsquo;s take a look at it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;x-generator&#34;</span>: <span style="color:#e6db74">&#34;NSwag v13.11.3.0 (NJsonSchema v10.4.4.0 (Newtonsoft.Json v12.0.0.0))&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;swagger&#34;</span>: <span style="color:#e6db74">&#34;2.0&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;info&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;My Title&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;1.0.0&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;produces&#34;</span>: [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;text/plain&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;text/json&#34;</span>
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;paths&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;/WeatherForecast&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;get&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tags&#34;</span>: [
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;WeatherForecast&#34;</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operationId&#34;</span>: <span style="color:#e6db74">&#34;WeatherForecast_Get&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;responses&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;200&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;x-nullable&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;schema&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;$ref&#34;</span>: <span style="color:#e6db74">&#34;#/definitions/WeatherForecast&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;definitions&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;WeatherForecast&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;required&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;temperatureC&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;temperatureF&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;date&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;date-time&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;temperatureC&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;int32&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;temperatureF&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;int32&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;summary&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Pretty good! The generator:</p>
<ol>
<li>Found the controller in the assembly.</li>
<li>Generated an object in <code>paths</code> for each controller method.</li>
<li>Generated definitions for the objects the controller returns.</li>
</ol>
<p>For a very simple controller, that Swagger document is a whopping 141 lines long!
I will grant that it is a full Swagger document with all of the ceremony of Swagger, but still even if it was only 70 lines that would be a huge change to review.
If the author tells me &ldquo;The swagger is automatically generated from the code&rdquo;, then I&rsquo;ll spend exactly 0 seconds looking at it and instead focus on reviewing the code that produced it.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Generating Swagger files from C# code is extremely easy with NSwag.
Armed with these tools, you can reduce the amount of time you spend toiling at the Swagger mines.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://gustavohidalgo.com/" >
    &copy;  Gustavo's blog 2022 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
