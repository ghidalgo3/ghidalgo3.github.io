<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Slightly complex VSCode launch configurations | Gustavo&#39;s blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="VSCode supports starting and debugging processes through its launch configuration system, largely configured with the tasks.json and launch.json editor configuration files. Launch configurations control what happens, and in what order, when you press F5 and the green play button in the debug pane. As a project grows in scope and in team members, I have learned that it is easier to tell other developers &ldquo;just press F5 and everything will just work&rdquo; rather than asking them to read README files.">
    <meta name="generator" content="Hugo 0.102.3" />
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="Slightly complex VSCode launch configurations" />
<meta property="og:description" content="VSCode supports starting and debugging processes through its launch configuration system, largely configured with the tasks.json and launch.json editor configuration files. Launch configurations control what happens, and in what order, when you press F5 and the green play button in the debug pane. As a project grows in scope and in team members, I have learned that it is easier to tell other developers &ldquo;just press F5 and everything will just work&rdquo; rather than asking them to read README files." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://gustavohidalgo.com/posts/2022-12-04-vcode-launch/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-04T12:34:23-04:00" />
<meta property="article:modified_time" content="2022-12-04T12:34:23-04:00" />

<meta itemprop="name" content="Slightly complex VSCode launch configurations">
<meta itemprop="description" content="VSCode supports starting and debugging processes through its launch configuration system, largely configured with the tasks.json and launch.json editor configuration files. Launch configurations control what happens, and in what order, when you press F5 and the green play button in the debug pane. As a project grows in scope and in team members, I have learned that it is easier to tell other developers &ldquo;just press F5 and everything will just work&rdquo; rather than asking them to read README files."><meta itemprop="datePublished" content="2022-12-04T12:34:23-04:00" />
<meta itemprop="dateModified" content="2022-12-04T12:34:23-04:00" />
<meta itemprop="wordCount" content="886">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Slightly complex VSCode launch configurations"/>
<meta name="twitter:description" content="VSCode supports starting and debugging processes through its launch configuration system, largely configured with the tasks.json and launch.json editor configuration files. Launch configurations control what happens, and in what order, when you press F5 and the green play button in the debug pane. As a project grows in scope and in team members, I have learned that it is easier to tell other developers &ldquo;just press F5 and everything will just work&rdquo; rather than asking them to read README files."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Gustavo&#39;s blog
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Slightly complex VSCode launch configurations</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-12-04T12:34:23-04:00">December 4, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>VSCode supports starting and <em>debugging</em> processes through its launch configuration system, largely configured with the <code>tasks.json</code> and <code>launch.json</code> editor configuration files.
Launch configurations control what happens, and in what order, when you press F5 and the green play button in the debug pane.
As a project grows in scope and in team members, I have learned that it is easier to tell other developers &ldquo;just press F5 and everything will just work&rdquo; rather than asking them to read README files.</p>
<p>Multiple times now I&rsquo;ve found myself in situations with complex launch configurations because the process being debugged depends on an external service like a database, an external application in a container, or a browser connected to the editor.
VSCode launch configurations can support starting all of our process dependencies, here I will describe how I&rsquo;ve done it in a few different situtations.</p>
<h1 id="1-process--1-debugger">1 process + 1 debugger</h1>
<p>The easiest case to handle is when pressing F5 does the following:</p>
<ol>
<li>Builds the code</li>
<li>Start exactly <strong>one</strong> process with a supported <a href="https://microsoft.github.io/debug-adapter-protocol/">debug adapter</a></li>
</ol>
<p>Your <code>task.json</code> will look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;2.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;tasks&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;build&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;command&#34;</span>: <span style="color:#e6db74">&#34;dotnet&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;process&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;args&#34;</span>: [<span style="color:#960050;background-color:#1e0010">..</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;problemMatcher&#34;</span>: <span style="color:#e6db74">&#34;$msCompile&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Where <code>command</code> is the CLI tool that builds your project, something like <code>make</code>, <code>maven</code>, <code>dotnet</code>, <code>cargo</code>, etc&hellip;.</p>
<p>Then in your <code>launch.json</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.2.0&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;configurations&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;App&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;coreclr&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;request&#34;</span>: <span style="color:#e6db74">&#34;launch&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;preLaunchTask&#34;</span>: <span style="color:#e6db74">&#34;build&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;program&#34;</span>: <span style="color:#e6db74">&#34;${workspaceFolder}/bin/Debug/net6.0/Blog.dll&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;args&#34;</span>: [],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;cwd&#34;</span>: <span style="color:#e6db74">&#34;${workspaceFolder}&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;stopAtEntry&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Note that the value of <code>preLaunchTask</code> is the <code>label</code> property of the task previously defined.
This tells VSCode to run the <code>build</code> task whenever the <code>App</code> launch configuration is invoked, which makes sense because you need to build your code before you can run it.</p>
<p>The final bit of magic is the <code>type</code> property of the launch configuration which tells VSCode how to debug the process that&rsquo;s about to be launched.
Language extensions usually provide a debug adapter which defines a value for <code>type</code>.</p>

<script async type="application/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js">
    var config = {
        startOnLoad: true,
        theme: 'dark',
        align: 'center'
    };
    mermaid.initialize(config);
</script>

<div class="mermaid">
    
sequenceDiagram
  actor User
  participant L as launch.json
  participant T as tasks.json

  User->>L: Debug process
  activate L
  L->>T: Build executable
  activate T
  T-->>L: Build finished
  deactivate T
  L-->>User: Launch debugger
  deactivate L

</div>
<p>That&rsquo;s the simplest scenario I can think of: 1 build, 1 process, 1 debug session.
Let&rsquo;s get more complex!</p>
<h1 id="2-processes--1-debugger">2 processes + 1 debugger</h1>
<p>As I write this blog, I have two processes running:</p>
<ol>
<li>An ASP.NET Core process mostly serving static files</li>
<li>A Hugo process watching for file changes and rebuilding the static assets</li>
</ol>
<p>To make this work, I will need to define 2 tasks:</p>
<ol>
<li>One that builds the C# code</li>
<li>One that starts the Hugo server file watcher</li>
</ol>
<p>And then I will make a launch configuration that depends on the two tasks and launches the debugger on the C# code.</p>
<p>Here&rsquo;s the tricky part: the C# build task <em>terminates</em> but the Hugo server task <em>does not terminate</em>.
For VSCode, this creates the need to inform the editor if a task is a so-called &ldquo;background&rdquo; task that never terminates and what the error messages of this task look like as a regular expression.
The editor could not otherwise determine if the debugger should launch when there is a problem with the background task.
The .NET Core extension conveniently handles this with a <code>problemMatcher</code> of type <code>$msCompile</code>, but it&rsquo;s common and easy to define our own problem matchers.</p>
<p>Let&rsquo;s take a closer look at the Hugo server output.
I launch the Hugo server with this command: <code>hugo -d ../wwwroot -w</code>.
The initial output of this program looks like this:</p>
<pre tabindex="0"><code>~/code/ghidalgo3.github.io/static ~/code/ghidalgo3.github.io
Start building sites … 
hugo v0.102.3+extended darwin/amd64 BuildDate=unknown

                   | EN  
-------------------+-----
  Pages            | 25  
  Paginator pages  |  0  
  Non-page files   |  0  
  Static files     |  1  
  Processed images |  0  
  Aliases          |  1  
  Sitemaps         |  1  
  Cleaned          |  0  

Watching for changes in /Users/gustavo/code/ghidalgo3.github.io/static/{archetypes,content,themes}
Press Ctrl+C to stop
Watching for config changes in /Users/gustavo/code/ghidalgo3.github.io/static/config.toml, /Users/gustavo/code/ghidalgo3.github.io/static/themes/ananke/config.yaml
</code></pre><p>This is an example of output with no errors.
Then when I edit a file, I see this output:</p>
<pre tabindex="0"><code>Change detected, rebuilding site.
2022-12-22 13:12:29.779 -0500
Source changed &#34;/Users/gustavo/code/ghidalgo3.github.io/static/content/posts/2022-12-04-vcode-launch.markdown&#34;: WRITE
Total in 6 ms
</code></pre><p>Again, no errors.</p>
<p>If Hugo had run into an error, it would produce output like this:</p>
<pre tabindex="0"><code>Change detected, rebuilding site.
2022-12-26 18:18:43.725 -0500
Source changed &#34;/Users/gustavo/code/ghidalgo3.github.io/static/content/posts/2022-12-04-vcode-launch.markdown&#34;: WRITE
ERROR 2022/12/26 18:18:43 Rebuild failed: &#34;/Users/gustavo/code/ghidalgo3.github.io/static/content/posts/2022-12-04-vcode-launch.markdown:123:1&#34;: failed to extract shortcode: template for shortcode &#34;fweiuf&#34; not found
Total in 2 ms
</code></pre><p>The line that starts with <code>ERROR</code> indicates that the task failed and it helpfully contains a filename, line number, and column number indicating the failure.
Let&rsquo;s see how we can create a task that starts the Hugo server, detects errors, and surfaces them for us:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;Hugo watch&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;command&#34;</span>: <span style="color:#e6db74">&#34;hugo&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;process&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;args&#34;</span>: [ <span style="color:#e6db74">&#34;-d&#34;</span>, <span style="color:#e6db74">&#34;../wwwroot&#34;</span>, <span style="color:#e6db74">&#34;-w&#34;</span> ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cwd&#34;</span>: <span style="color:#e6db74">&#34;${workspaceFolder}/static&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;isBackground&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;problemMatcher&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;owner&#34;</span>: <span style="color:#e6db74">&#34;hugo&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;fileLocation&#34;</span>: <span style="color:#e6db74">&#34;absolute&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;pattern&#34;</span>:[
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;regexp&#34;</span>: <span style="color:#e6db74">&#34;ERROR.*\&#34;(.+):(\\d+):(\\d+).*\&#34;: (.+)&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;file&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;line&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;column&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;background&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;activeOnStart&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;beginsPattern&#34;</span>: <span style="color:#e6db74">&#34;Start building sites&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;endsPattern&#34;</span>: <span style="color:#e6db74">&#34;Watching for config changes in&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="starting-and-debugging-multiple-processes">Starting and debugging multiple processes.</h1>
<p>In web applications, the database is usually a separate process from
Database start scripts fall into two categories: those that terminate and those that don&rsquo;t.
Examples of the ones that do:</p>
<ol>
<li><code>systemd</code> start service calls</li>
<li><code>SysV</code> init scripts</li>
<li><code>Windows Service</code> service start calls</li>
</ol>
<p>Examples of the ones that don&rsquo;t:</p>
<ol>
<li><code>azurite</code></li>
</ol>
<h2 id="launch">Launch</h2>
<h1 id="conclusion">Conclusion</h1>
<h1 id="references">References</h1>
<ol>
<li><a href="https://code.visualstudio.com/docs/editor/debugging">https://code.visualstudio.com/docs/editor/debugging</a></li>
</ol>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://gustavohidalgo.com/" >
    &copy;  Gustavo's blog 2022 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
